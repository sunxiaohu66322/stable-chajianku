import{d as te,$ as x,aw as le,bQ as ne,bP as A,o as a,y as b,q as T,c as o,r as e,bT as ie,p as v,N as y,m as g,n as r,x as I,v as f,C as w,s as K,t as ae,L as oe,ax as re,al as de,ai as ue,U as ce,V as pe,Q as me,R as ve,X as ge}from"./index-4399f518.js";import{L as fe,R as we,f as ke,S as xe}from"./fullScreenContextMenu-795d4b7d.js";/* empty css              */import{g as be,F as ye}from"./FileItem-f4ef090a.js";import{b as N,c as Ie,f as P,u as Ce}from"./db-ccfd5d0c.js";import{c as he,u as _e}from"./hook-77feb202.js";import"./functionalCallableComp-03af9871.js";const Se="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",Me=["src"],$e={class:"hint"},ze={key:1,class:"preview-switch"},De=te({__name:"SubstrSearch",setup(Be){const p=x(!1),u=x(""),C=he(l=>p.value?P("",l,u.value):P(u.value,l)),{queue:d,images:i,onContextMenuClickU:h,stackViewEl:q,previewIdx:c,previewing:_,onPreviewVisibleChange:L,previewImgMove:S,canPreview:M,itemSize:$,gridItems:G,showGenInfo:m,imageGenInfo:z,q:O,multiSelectedIdxs:D,onFileItemClick:Q,scroller:B,showMenuIdx:k,onFileDragStart:H,onFileDragEnd:W,cellWidth:X,onScroll:V}=_e(C),t=x();le(async()=>{t.value=await N(),t.value.img_count&&t.value.expired&&E()});const E=ne(()=>d.pushAction(async()=>(await Ce(),t.value=await N(),t.value)).res),F=async()=>{await C.reset({refetch:!0}),await re(),V(),B.value.scrollToItem(0),i.value.length||de.info(ue("fuzzy-search-noResults"))};A("returnToIIB",async()=>{const l=await d.pushAction(Ie).res;t.value.expired=l.expired}),A("searchIndexExpired",()=>t.value&&(t.value.expired=!0));const j=()=>{p.value=!p.value};return(l,s)=>{const J=ce,R=pe,Y=me,Z=ve,ee=xe;return a(),b("div",{class:"container",ref_key:"stackViewEl",ref:q},[t.value?(a(),b("div",{key:0,class:"search-bar",onKeydown:s[2]||(s[2]=T(()=>{},["stop"]))},[o(J,{value:u.value,"onUpdate:value":s[0]||(s[0]=n=>u.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(d).isIdle,onKeydown:ie(F,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),v("div",{class:y(["regex-icon",{selected:p.value}]),onKeydown:s[1]||(s[1]=T(()=>{},["stop"])),onClick:j,title:"Use Regular Expression"},[v("img",{src:e(Se)},null,8,Me)],34),t.value.expired||!t.value.img_count?(a(),g(R,{key:0,onClick:e(E),loading:!e(d).isIdle,type:"primary"},{default:r(()=>[I(f(t.value.img_count===0?l.$t("generateIndexHint"):l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(a(),g(R,{key:1,type:"primary",onClick:F,loading:!e(d).isIdle,disabled:!u.value},{default:r(()=>[I(f(l.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):w("",!0),o(ee,{size:"large",spinning:!e(d).isIdle},{default:r(()=>[o(Z,{visible:e(m),"onUpdate:visible":s[4]||(s[4]=n=>K(m)?m.value=n:null),width:"70vw","mask-closable":"",onOk:s[5]||(s[5]=n=>m.value=!1)},{cancelText:r(()=>[]),default:r(()=>[o(Y,{active:"",loading:!e(O).isIdle},{default:r(()=>[v("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[3]||(s[3]=n=>e(ae)(e(z)))},[v("div",$e,f(l.$t("doubleClickToCopy")),1),I(" "+f(e(z)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(i)?(a(),g(e(be),{key:0,ref_key:"scroller",ref:B,class:"file-list",items:e(i),"item-size":e($).first,"key-field":"fullpath","item-secondary-size":e($).second,gridItems:e(G),onScroll:e(V)},{default:r(({item:n,index:U})=>[o(ye,{idx:U,file:n,"show-menu-idx":e(k),"onUpdate:showMenuIdx":s[6]||(s[6]=se=>K(k)?k.value=se:null),onFileItemClick:e(Q),"full-screen-preview-image-url":e(i)[e(c)]?e(oe)(e(i)[e(c)]):"","cell-width":e(X),selected:e(D).includes(U),onContextMenuClick:e(h),onDragstart:e(H),onDragend:e(W),"is-selected-mutil-files":e(D).length>1,onPreviewVisibleChange:e(L)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):w("",!0),e(_)?(a(),b("div",ze,[o(e(fe),{onClick:s[7]||(s[7]=n=>e(S)("prev")),class:y({disable:!e(M)("prev")})},null,8,["class"]),o(e(we),{onClick:s[8]||(s[8]=n=>e(S)("next")),class:y({disable:!e(M)("next")})},null,8,["class"])])):w("",!0)]),_:1},8,["spinning"]),e(_)&&e(i)&&e(i)[e(c)]?(a(),g(ke,{key:1,file:e(i)[e(c)],idx:e(c),onContextMenuClick:e(h)},null,8,["file","idx","onContextMenuClick"])):w("",!0)],512)}}});const Ke=ge(De,[["__scopeId","data-v-bbf17c78"]]);export{Ke as default};
